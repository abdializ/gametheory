(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8],{3294:(e,t,s)=>{Promise.resolve().then(s.bind(s,450))},450:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var a=s(5155),l=s(2115),r=s(6046),o=s(7396);let n=function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let s=0,a=0;return"cooperate"===e&&"cooperate"===t?s=a=3:"cooperate"===e&&"defect"===t?(s=0,a=5):"defect"===e&&"cooperate"===t?(s=5,a=0):s=a=1,{player1:s,player2:a,bonuses:[]}},c={"always-cooperate":()=>"cooperate","always-defect":()=>"defect",random:()=>.5>Math.random()?"cooperate":"defect","tit-for-tat":(e,t)=>{if(0===e.length)return"cooperate";let s=e[e.length-1];return 1===t?s.player2:s.player1},grudger:(e,t)=>e.some(e=>(1===t?e.player2:e.player1)==="defect")?"defect":"cooperate"};function i(){let e=(0,r.useSearchParams)(),t=null==e?void 0:e.get("mode"),s=null==e?void 0:e.get("bot"),[i,d]=(0,l.useState)("menu"),[x,m]=(0,l.useState)(0),[p,h]=(0,l.useState)({player1:0,player2:0}),[u,g]=(0,l.useState)([]),[y,b]=(0,l.useState)(null),[j,f]=(0,l.useState)(""),[N,v]=(0,l.useState)(""),[w]=(0,l.useState)(()=>"player_".concat(Math.random().toString(36).substr(2,9))),[C,S]=(0,l.useState)(0),[O,k]=(0,l.useState)(0),[R,D]=(0,l.useState)(!1),[F,P]=(0,l.useState)(!1),[B,E]=(0,l.useState)(null),[Y,T]=(0,l.useState)(""),_="bot"===t,H="multiplayer"===t;(0,l.useEffect)(()=>{if(!H||!j||"menu"===i||"gameOver"===i)return;let e=setInterval(async()=>{try{let e=await fetch("/api/game/state?roomCode=".concat(j,"&playerId=").concat(w));if(e.ok){let t=await e.json();k(t.playerCount),h(t.scores),g(t.gameHistory||[]),"finished"===t.gameState?d("gameOver"):"playing"===t.gameState&&("waiting"===i&&d("choosing"),m(t.currentRound),void 0!==t.opponentHasChosen&&P(t.opponentHasChosen),t.myChoice&&!B&&E(t.myChoice),t.lastRound&&t.lastRound.round===x?(b(t.lastRound),h(t.scores),g(t.gameHistory||[]),D(!1),P(!1),E(null),d("roundResult")):void 0!==t.waitingForOpponent&&D(t.waitingForOpponent))}}catch(e){}},1e3);return()=>clearInterval(e)},[H,j,w,i,x,R]);let M=async()=>{try{let e=await fetch("/api/game/create",{method:"POST"}),t=await e.json();t.roomCode&&(f(t.roomCode),await I(t.roomCode))}catch(e){T("Failed to create room")}},I=async e=>{try{let t=await fetch("/api/game/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomCode:e,playerId:w})});if(t.ok){let s=await t.json();f(e),S(s.room.playerNumber),k(s.room.playerCount),h(s.room.scores),m(s.room.currentRound),"playing"===s.room.gameState?d("choosing"):d("waiting")}else{let e=await t.json();T(e.error||"Failed to join room")}}catch(e){T("Failed to join room")}},J=()=>{N.trim()&&I(N.trim())},W=async e=>{if(_){let t=c[s](u,2),a=n(e,t,u);h({player1:p.player1+a.player1,player2:p.player2+a.player2});let l={round:x+1,player1:e,player2:t,payoffs:a};g([...u,l]),b(l),x+1>=15?d("gameOver"):(m(x+1),d("roundResult"))}else{E(e),D(!0),P(!1);try{let t=await fetch("/api/game/choice",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomCode:j,playerId:w,choice:e})});if(t.ok){let e=await t.json();!e.waitingForOpponent&&e.lastRound&&(b(e.lastRound),h(e.scores),m(e.currentRound),g(e.gameHistory),D(!1),P(!1),E(null),"finished"===e.gameState?d("gameOver"):d("roundResult"))}else T("Failed to submit choice"),D(!1),E(null)}catch(e){T("Failed to submit choice"),D(!1),E(null)}}},A=()=>{d("choosing"),b(null),D(!1),P(!1),E(null)};(0,l.useEffect)(()=>{if("roundResult"===i&&!_&&x<15){let e=setTimeout(()=>{d("choosing"),b(null),D(!1),P(!1),E(null)},3e3);return()=>clearTimeout(e)}},[i,x,_,B]);let L=()=>{d("menu"),m(0),h({player1:0,player2:0}),g([]),b(null),f(""),S(0),k(0),D(!1),P(!1),E(null),T("")};return(0,l.useEffect)(()=>{_&&s&&"menu"===i&&(d("choosing"),m(1))},[_,s,i]),(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900 text-white p-8",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:["menu"===i&&(0,a.jsx)(()=>(0,a.jsxs)("div",{className:"text-center space-y-6",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold mb-4",children:"Prisoner's Dilemma"}),(0,a.jsx)("p",{className:"text-gray-300 mb-8",children:"A game theory experiment in cooperation and betrayal"}),Y&&(0,a.jsx)("div",{className:"bg-red-900/50 border border-red-500 text-red-200 px-4 py-3 rounded mb-4",children:Y}),(0,a.jsxs)("div",{className:"space-y-4",children:[H&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:M,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors",children:"Create Room"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:N,onChange:e=>v(e.target.value.toUpperCase()),onKeyDown:e=>{"Enter"===e.key&&J()},placeholder:"Enter room code",className:"flex-1 bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400",maxLength:6,autoFocus:!0},"room-code-input"),(0,a.jsx)("button",{onClick:J,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors",children:"Join"})]})]}),(0,a.jsx)(o.default,{href:"/",className:"block w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors text-center",children:"Back to Menu"})]})]}),{}),"waiting"===i&&(0,a.jsx)(()=>(0,a.jsxs)("div",{className:"text-center space-y-6",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold",children:"Waiting for Opponent..."}),(0,a.jsxs)("div",{className:"bg-blue-900/30 border border-blue-500 rounded-lg p-6",children:[(0,a.jsxs)("p",{className:"text-xl mb-2",children:["Room Code: ",(0,a.jsx)("span",{className:"font-mono font-bold text-2xl",children:j})]}),(0,a.jsx)("p",{className:"text-gray-300",children:"Share this code with a friend"})]}),(0,a.jsxs)("p",{className:"text-gray-400",children:["Players: ",O,"/2"]}),(0,a.jsx)("button",{onClick:L,className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded-lg transition-colors",children:"Cancel"})]}),{}),"choosing"===i&&(0,a.jsx)(()=>(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold mb-2",children:["Round ",x," / ",15]}),(0,a.jsxs)("div",{className:"text-lg",children:[(0,a.jsxs)("span",{className:"text-blue-400",children:["You: ",p.player1]}),(0,a.jsx)("span",{className:"mx-4",children:"|"}),(0,a.jsxs)("span",{className:"text-red-400",children:[_?"Bot":"Opponent",": ",p.player2]})]})]}),!_&&C>0&&(0,a.jsxs)("div",{className:"text-center text-gray-400",children:["You are Player ",C]}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-4 text-center",children:"Make Your Choice"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("button",{onClick:()=>W("cooperate"),disabled:R,className:"bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-8 px-6 rounded-lg transition-colors",children:[(0,a.jsx)("div",{className:"text-2xl mb-2",children:"\uD83E\uDD1D"}),(0,a.jsx)("div",{className:"text-xl",children:"Cooperate"}),(0,a.jsx)("div",{className:"text-sm text-gray-300 mt-2",children:"Work together"})]}),(0,a.jsxs)("button",{onClick:()=>W("defect"),disabled:R,className:"bg-red-600 hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-8 px-6 rounded-lg transition-colors",children:[(0,a.jsx)("div",{className:"text-2xl mb-2",children:"⚔️"}),(0,a.jsx)("div",{className:"text-xl",children:"Defect"}),(0,a.jsx)("div",{className:"text-sm text-gray-300 mt-2",children:"Betray them"})]})]})]}),R&&(0,a.jsx)("div",{className:"space-y-2",children:(0,a.jsxs)("div",{className:"text-center text-yellow-400 animate-pulse",children:[B&&(0,a.jsxs)("div",{className:"mb-2",children:["You chose: ",(0,a.jsx)("span",{className:"font-bold",children:"cooperate"===B?"\uD83E\uDD1D Cooperate":"⚔️ Defect"})]}),F?(0,a.jsx)("div",{className:"text-green-400",children:"✓ Opponent has chosen! Processing..."}):(0,a.jsx)("div",{children:"Waiting for opponent to choose..."})]})})]}),{}),"roundResult"===i&&(0,a.jsx)(()=>y?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold mb-2",children:["Round ",y.round," Result"]}),(0,a.jsxs)("div",{className:"text-lg",children:[(0,a.jsxs)("span",{className:"text-blue-400",children:["You: ",p.player1]}),(0,a.jsx)("span",{className:"mx-4",children:"|"}),(0,a.jsxs)("span",{className:"text-red-400",children:[_?"Bot":"Opponent",": ",p.player2]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-gray-400 mb-2",children:"You chose"}),(0,a.jsx)("div",{className:"text-2xl font-bold ".concat("cooperate"===y.player1?"text-green-400":"text-red-400"),children:"cooperate"===y.player1?"\uD83E\uDD1D Cooperate":"⚔️ Defect"}),(0,a.jsxs)("div",{className:"text-3xl font-bold mt-2",children:["+",y.payoffs.player1]})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-gray-400 mb-2",children:[_?"Bot":"Opponent"," chose"]}),(0,a.jsx)("div",{className:"text-2xl font-bold ".concat("cooperate"===y.player2?"text-green-400":"text-red-400"),children:"cooperate"===y.player2?"\uD83E\uDD1D Cooperate":"⚔️ Defect"}),(0,a.jsxs)("div",{className:"text-3xl font-bold mt-2",children:["+",y.payoffs.player2]})]})]}),y.payoffs.bonuses&&y.payoffs.bonuses.length>0&&(0,a.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[(0,a.jsx)("p",{className:"text-sm text-gray-400 mb-2",children:"Bonuses:"}),y.payoffs.bonuses.map((e,t)=>(0,a.jsx)("p",{className:"text-sm text-yellow-400",children:e},t))]})]}),_&&x<15&&(0,a.jsx)("button",{onClick:A,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors",children:"Next Round"}),!_&&x<15&&(0,a.jsx)("div",{className:"text-center text-gray-400",children:"Next round starting automatically..."})]}):null,{}),"gameOver"===i&&(0,a.jsx)(()=>{let e=p.player1>p.player2?"You win!":p.player1<p.player2?_?"Bot wins!":"Opponent wins!":"It's a tie!";return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-4xl font-bold mb-4",children:e}),(0,a.jsxs)("div",{className:"text-2xl mb-6",children:[(0,a.jsxs)("span",{className:"text-blue-400",children:["You: ",p.player1]}),(0,a.jsx)("span",{className:"mx-4",children:"|"}),(0,a.jsxs)("span",{className:"text-red-400",children:[_?"Bot":"Opponent",": ",p.player2]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 max-h-96 overflow-y-auto",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Game History"}),(0,a.jsx)("div",{className:"space-y-2",children:u.map((e,t)=>(0,a.jsxs)("div",{className:"flex justify-between items-center border-b border-gray-700 pb-2",children:[(0,a.jsxs)("span",{className:"text-gray-400",children:["Round ",e.round]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("span",{className:"cooperate"===e.player1?"text-green-400":"text-red-400",children:["You: ","cooperate"===e.player1?"\uD83E\uDD1D":"⚔️"," (+",e.payoffs.player1,")"]}),(0,a.jsxs)("span",{className:"cooperate"===e.player2?"text-green-400":"text-red-400",children:[_?"Bot":"Opp",": ","cooperate"===e.player2?"\uD83E\uDD1D":"⚔️"," (+",e.payoffs.player2,")"]})]})]},t))})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("button",{onClick:L,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors",children:"Play Again"}),(0,a.jsx)(o.default,{href:"/",className:"flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors text-center",children:"Main Menu"})]})]})},{})]})})}function d(){return(0,a.jsx)(l.Suspense,{fallback:(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900 text-white flex items-center justify-center",children:"Loading..."}),children:(0,a.jsx)(i,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[463,441,517,358],()=>t(3294)),_N_E=e.O()}]);