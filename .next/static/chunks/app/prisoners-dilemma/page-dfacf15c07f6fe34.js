(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8],{3294:(e,t,a)=>{Promise.resolve().then(a.bind(a,450))},450:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var s=a(5155),r=a(2115),l=a(6046),o=a(7396);let n=function(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2];let a=0,s=0;return"cooperate"===e&&"cooperate"===t?a=s=3:"cooperate"===e&&"defect"===t?(a=0,s=5):"defect"===e&&"cooperate"===t?(a=5,s=0):a=s=1,{player1:a,player2:s,bonuses:[]}},c={"always-cooperate":()=>"cooperate","always-defect":()=>"defect",random:()=>.5>Math.random()?"cooperate":"defect","tit-for-tat":(e,t)=>{if(0===e.length)return"cooperate";let a=e[e.length-1];return 1===t?a.player2:a.player1},grudger:(e,t)=>e.some(e=>(1===t?e.player2:e.player1)==="defect")?"defect":"cooperate"};function i(){let e=(0,l.useSearchParams)(),t=null==e?void 0:e.get("mode"),a=null==e?void 0:e.get("bot"),[i,d]=(0,r.useState)("menu"),[x,m]=(0,r.useState)(0),[p,h]=(0,r.useState)({player1:0,player2:0}),[u,g]=(0,r.useState)([]),[y,b]=(0,r.useState)(null),[f,j]=(0,r.useState)(""),[N,v]=(0,r.useState)(""),w=()=>{let e=["Swift","Bold","Wise","Quick","Smart","Clever","Brave","Calm","Cool","Epic"],t=["Eagle","Tiger","Wolf","Bear","Lion","Fox","Owl","Hawk","Shark","Panda"];return"".concat(e[Math.floor(Math.random()*e.length)]).concat(t[Math.floor(Math.random()*t.length)])},[C,S]=(0,r.useState)(""),[k,R]=(0,r.useState)(""),[O]=(0,r.useState)(()=>"player_".concat(Math.random().toString(36).substr(2,9))),[E,F]=(0,r.useState)(0),[D,B]=(0,r.useState)(0),[P,M]=(0,r.useState)(!1),[T,H]=(0,r.useState)(!1),[I,_]=(0,r.useState)(null),[Y,J]=(0,r.useState)(""),W="bot"===t,L="multiplayer"===t;(0,r.useEffect)(()=>{if(!L||!C||"menu"===i||"gameOver"===i)return;let e=setInterval(async()=>{try{let e=await fetch("/api/game/state?roomCode=".concat(C,"&playerId=").concat(O));if(e.ok){let t=await e.json();if(B(t.playerCount),h(t.scores),g(t.gameHistory||[]),!N&&t.players&&t.players.length>1){let e=t.players.find(e=>e.id!==O);e&&v(e.name)}"finished"===t.gameState?d("gameOver"):"playing"===t.gameState&&("waiting"===i&&d("choosing"),m(t.currentRound),void 0!==t.opponentHasChosen&&H(t.opponentHasChosen),t.myChoice&&!I&&_(t.myChoice),t.lastRound&&t.lastRound.round===x?(b(t.lastRound),h(t.scores),g(t.gameHistory||[]),M(!1),H(!1),_(null),d("roundResult")):void 0!==t.waitingForOpponent&&M(t.waitingForOpponent))}}catch(e){}},1e3);return()=>clearInterval(e)},[L,C,O,i,x,P,N,I]);let G=()=>{f.trim()||j(w()),W?(v("".concat(null==a?void 0:a.replace("-"," ").replace(/\b\w/g,e=>e.toUpperCase())," Bot")),d("choosing"),m(1)):d("waiting")},A=()=>{d("nameInput")},U=async e=>{try{let t=await fetch("/api/game/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomCode:e,playerId:O,playerName:f||w()})});if(t.ok){let a=await t.json();if(S(e),F(a.room.playerNumber),B(a.room.playerCount),h(a.room.scores),m(a.room.currentRound),j(a.playerName),a.room.players&&a.room.players.length>1){let e=a.room.players.find(e=>e.id!==O);e&&v(e.name)}"playing"===a.room.gameState?d("choosing"):d("waiting")}else{let e=await t.json();J(e.error||"Failed to join room")}}catch(e){J("Failed to join room")}},K=()=>{k.trim()&&d("nameInput")},Q=async()=>{try{let e=await fetch("/api/game/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({playerName:f||w()})}),t=await e.json();t.roomCode&&(S(t.roomCode),j(t.playerName),await U(t.roomCode))}catch(e){J("Failed to create room")}},q=()=>{k.trim()&&U(k.trim())},z=async e=>{if(W){let t=c[a](u,2),s=n(e,t,u);h({player1:p.player1+s.player1,player2:p.player2+s.player2});let r={round:x+1,player1:e,player2:t,payoffs:s};g([...u,r]),b(r),x+1>=15?d("gameOver"):(m(x+1),d("roundResult"))}else{_(e),M(!0),H(!1);try{let t=await fetch("/api/game/choice",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({roomCode:C,playerId:O,choice:e})});if(t.ok){let e=await t.json();!e.waitingForOpponent&&e.lastRound&&(b(e.lastRound),h(e.scores),m(e.currentRound),g(e.gameHistory),M(!1),H(!1),_(null),"finished"===e.gameState?d("gameOver"):d("roundResult"))}else J("Failed to submit choice"),M(!1),_(null)}catch(e){J("Failed to submit choice"),M(!1),_(null)}}},V=()=>{d("choosing"),b(null),M(!1),H(!1),_(null)};(0,r.useEffect)(()=>{if("roundResult"===i&&!W&&x<15){let e=setTimeout(()=>{d("choosing"),b(null),M(!1),H(!1),_(null)},3e3);return()=>clearTimeout(e)}},[i,x,W,I]);let X=()=>{d("menu"),m(0),h({player1:0,player2:0}),g([]),b(null),S(""),F(0),B(0),M(!1),H(!1),_(null),J("")};return(0,r.useEffect)(()=>{W&&a&&"menu"===i&&(d("choosing"),m(1))},[W,a,i]),(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900 text-white p-8",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:["menu"===i&&(0,s.jsx)(()=>(0,s.jsxs)("div",{className:"text-center space-y-6",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold mb-4",children:"Prisoner's Dilemma"}),(0,s.jsx)("p",{className:"text-gray-300 mb-8",children:"A game theory experiment in cooperation and betrayal"}),Y&&(0,s.jsx)("div",{className:"bg-red-900/50 border border-red-500 text-red-200 px-4 py-3 rounded mb-4",children:Y}),(0,s.jsxs)("div",{className:"space-y-4",children:[L&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:A,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors",children:"Create Room"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"text",value:k,onChange:e=>R(e.target.value.toUpperCase()),onKeyDown:e=>{"Enter"===e.key&&K()},placeholder:"Enter room code",className:"flex-1 bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white placeholder-gray-400",maxLength:6,autoFocus:!0},"room-code-input"),(0,s.jsx)("button",{onClick:K,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors",children:"Join"})]})]}),(0,s.jsx)(o.default,{href:"/",className:"block w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors text-center",children:"Back to Menu"})]})]}),{}),"nameInput"===i&&(0,s.jsx)(()=>(0,s.jsxs)("div",{className:"text-center space-y-6",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold mb-4",children:"Enter Your Name"}),(0,s.jsx)("p",{className:"text-gray-300 mb-8",children:"Choose a temporary name for this game"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex gap-2 max-w-md mx-auto",children:[(0,s.jsx)("input",{type:"text",value:f,onChange:e=>j(e.target.value),placeholder:"Enter your name",className:"flex-1 bg-gray-800 border border-gray-600 rounded-lg px-4 py-3 text-white",maxLength:20,autoFocus:!0}),(0,s.jsx)("button",{onClick:()=>j(w()),className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded-lg transition-colors",title:"Generate random name",children:"\uD83C\uDFB2"})]}),(0,s.jsxs)("div",{className:"flex gap-4 justify-center",children:[L&&k.trim()?(0,s.jsx)("button",{onClick:q,className:"bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg transition-colors",children:"Join Room"}):(0,s.jsx)("button",{onClick:W?G:Q,className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors",children:W?"Start Game":"Create Room"}),(0,s.jsx)("button",{onClick:()=>d("menu"),className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors",children:"Back"})]})]})]}),{}),"waiting"===i&&(0,s.jsx)(()=>(0,s.jsxs)("div",{className:"text-center space-y-6",children:[(0,s.jsx)("h2",{className:"text-3xl font-bold",children:"Waiting for Opponent..."}),(0,s.jsxs)("div",{className:"bg-blue-900/30 border border-blue-500 rounded-lg p-6",children:[(0,s.jsxs)("p",{className:"text-xl mb-2",children:["Room Code: ",(0,s.jsx)("span",{className:"font-mono font-bold text-2xl",children:C})]}),(0,s.jsx)("p",{className:"text-gray-300",children:"Share this code with a friend"})]}),(0,s.jsxs)("p",{className:"text-gray-400",children:["Players: ",D,"/2"]}),(0,s.jsx)("button",{onClick:X,className:"bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded-lg transition-colors",children:"Cancel"})]}),{}),"choosing"===i&&(0,s.jsx)(()=>{let e=W?p.player1:1===E?p.player1:p.player2,t=W?p.player2:1===E?p.player2:p.player1;return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("h2",{className:"text-2xl font-bold mb-2",children:["Round ",x," / ",15]}),(0,s.jsxs)("div",{className:"text-lg",children:[(0,s.jsxs)("span",{className:"text-blue-400",children:[f,": ",e]}),(0,s.jsx)("span",{className:"mx-4",children:"vs"}),(0,s.jsxs)("span",{className:"text-red-400",children:[N,": ",t]})]})]}),!W&&E>0&&(0,s.jsxs)("div",{className:"text-center text-gray-400",children:["You are Player ",E]}),(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 mb-6",children:[(0,s.jsx)("h3",{className:"text-xl font-bold mb-4 text-center",children:"Make Your Choice"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("button",{onClick:()=>z("cooperate"),disabled:P,className:"bg-green-600 hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-8 px-6 rounded-lg transition-colors",children:[(0,s.jsx)("div",{className:"text-2xl mb-2",children:"\uD83E\uDD1D"}),(0,s.jsx)("div",{className:"text-xl",children:"Cooperate"}),(0,s.jsx)("div",{className:"text-sm text-gray-300 mt-2",children:"Work together"})]}),(0,s.jsxs)("button",{onClick:()=>z("defect"),disabled:P,className:"bg-red-600 hover:bg-red-700 disabled:bg-gray-600 disabled:cursor-not-allowed text-white font-bold py-8 px-6 rounded-lg transition-colors",children:[(0,s.jsx)("div",{className:"text-2xl mb-2",children:"⚔️"}),(0,s.jsx)("div",{className:"text-xl",children:"Defect"}),(0,s.jsx)("div",{className:"text-sm text-gray-300 mt-2",children:"Betray them"})]})]})]}),P&&(0,s.jsx)("div",{className:"space-y-2",children:(0,s.jsxs)("div",{className:"text-center text-yellow-400 animate-pulse",children:[I&&(0,s.jsxs)("div",{className:"mb-2",children:["You chose: ",(0,s.jsx)("span",{className:"font-bold",children:"cooperate"===I?"\uD83E\uDD1D Cooperate":"⚔️ Defect"})]}),T?(0,s.jsx)("div",{className:"text-green-400",children:"✓ Opponent has chosen! Processing..."}):(0,s.jsx)("div",{children:"Waiting for opponent to choose..."})]})})]})},{}),"roundResult"===i&&(0,s.jsx)(()=>{if(!y)return null;let e=W?p.player1:1===E?p.player1:p.player2,t=W?p.player2:1===E?p.player2:p.player1;return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("h2",{className:"text-2xl font-bold mb-2",children:["Round ",y.round," Result"]}),(0,s.jsxs)("div",{className:"text-lg",children:[(0,s.jsxs)("span",{className:"text-blue-400",children:[f,": ",e]}),(0,s.jsx)("span",{className:"mx-4",children:"vs"}),(0,s.jsxs)("span",{className:"text-red-400",children:[N,": ",t]})]})]}),(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-gray-400 mb-2",children:"You chose"}),(0,s.jsx)("div",{className:"text-2xl font-bold ".concat("cooperate"===y.player1?"text-green-400":"text-red-400"),children:"cooperate"===y.player1?"\uD83E\uDD1D Cooperate":"⚔️ Defect"}),(0,s.jsxs)("div",{className:"text-3xl font-bold mt-2",children:["+",y.payoffs.player1]})]}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsxs)("div",{className:"text-gray-400 mb-2",children:[W?"Bot":"Opponent"," chose"]}),(0,s.jsx)("div",{className:"text-2xl font-bold ".concat("cooperate"===y.player2?"text-green-400":"text-red-400"),children:"cooperate"===y.player2?"\uD83E\uDD1D Cooperate":"⚔️ Defect"}),(0,s.jsxs)("div",{className:"text-3xl font-bold mt-2",children:["+",y.payoffs.player2]})]})]}),y.payoffs.bonuses&&y.payoffs.bonuses.length>0&&(0,s.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-700",children:[(0,s.jsx)("p",{className:"text-sm text-gray-400 mb-2",children:"Bonuses:"}),y.payoffs.bonuses.map((e,t)=>(0,s.jsx)("p",{className:"text-sm text-yellow-400",children:e},t))]})]}),W&&x<15&&(0,s.jsx)("button",{onClick:V,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors",children:"Next Round"}),!W&&x<15&&(0,s.jsx)("div",{className:"text-center text-gray-400",children:"Next round starting automatically..."})]})},{}),"gameOver"===i&&(0,s.jsx)(()=>{let e=W?p.player1:1===E?p.player1:p.player2,t=W?p.player2:1===E?p.player2:p.player1,a=e>t?"".concat(f," wins!"):e<t?"".concat(N," wins!"):"It's a tie!";return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h2",{className:"text-4xl font-bold mb-4",children:a}),(0,s.jsxs)("div",{className:"text-2xl mb-6",children:[(0,s.jsxs)("span",{className:"text-blue-400",children:[f,": ",e]}),(0,s.jsx)("span",{className:"mx-4",children:"vs"}),(0,s.jsxs)("span",{className:"text-red-400",children:[N,": ",t]})]})]}),(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 max-h-96 overflow-y-auto",children:[(0,s.jsx)("h3",{className:"text-xl font-bold mb-4",children:"Game History"}),(0,s.jsx)("div",{className:"space-y-2",children:u.map((e,t)=>(0,s.jsxs)("div",{className:"flex justify-between items-center border-b border-gray-700 pb-2",children:[(0,s.jsxs)("span",{className:"text-gray-400",children:["Round ",e.round]}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsxs)("span",{className:"cooperate"===e.player1?"text-green-400":"text-red-400",children:["You: ","cooperate"===e.player1?"\uD83E\uDD1D":"⚔️"," (+",e.payoffs.player1,")"]}),(0,s.jsxs)("span",{className:"cooperate"===e.player2?"text-green-400":"text-red-400",children:[W?"Bot":"Opp",": ","cooperate"===e.player2?"\uD83E\uDD1D":"⚔️"," (+",e.payoffs.player2,")"]})]})]},t))})]}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("button",{onClick:X,className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition-colors",children:"Play Again"}),(0,s.jsx)(o.default,{href:"/",className:"flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition-colors text-center",children:"Main Menu"})]})]})},{})]})})}function d(){return(0,s.jsx)(r.Suspense,{fallback:(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-blue-900 to-gray-900 text-white flex items-center justify-center",children:"Loading..."}),children:(0,s.jsx)(i,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[463,441,517,358],()=>t(3294)),_N_E=e.O()}]);